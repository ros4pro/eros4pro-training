

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Driver for Ultrasonic Sensor &mdash; eros4pro training 0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/contentui.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/hacks.css" type="text/css" />
  <link rel="stylesheet" href="../_static/contentui.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Find the Robot" href="findrobot.html" />
    <link rel="prev" title="Day 5" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> eros4pro training
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../day1/index.html">Day 1</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../day2/index.html">Day 2</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../day3/index.html">Day 3</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../day4/index.html">Day 4</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Day 5</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Driver for Ultrasonic Sensor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#communicating-with-arduino">Communicating with Arduino</a></li>
<li class="toctree-l3"><a class="reference internal" href="#back-to-ros">Back to ROS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#integrating-two-pieces-of-code">Integrating two pieces of code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#optional-visualize-data">Optional: visualize data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#optional-move-robot">Optional: move robot</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="findrobot.html">Find the Robot</a></li>
<li class="toctree-l2"><a class="reference internal" href="coderobot.html">Move the Robot</a></li>
<li class="toctree-l2"><a class="reference internal" href="securerobot.html">Where Is That Security?</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">eros4pro training</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Day 5</a> &raquo;</li>
        
      <li>Driver for Ultrasonic Sensor</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/day5/arduinodriver.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="driver-for-ultrasonic-sensor">
<h1>Driver for Ultrasonic Sensor<a class="headerlink" href="#driver-for-ultrasonic-sensor" title="Permalink to this headline">¶</a></h1>
<p>In this exercise we will write a driver for an ultrasonic sensor using the <code class="docutils literal notranslate"><span class="pre">rosserial</span></code> software package.</p>
<section id="communicating-with-arduino">
<h2>Communicating with Arduino<a class="headerlink" href="#communicating-with-arduino" title="Permalink to this headline">¶</a></h2>
<p>Install Arduino IDE on your system. You can find the IDE <a class="reference external" href="https://www.arduino.cc/en/software">here</a>.</p>
<p>Then download <a class="reference external" href="https://github.com/unitartu-edu/ultrasonic_ranger_arduino.git">this</a> sample code, compile it and upload it to Arduino. If you have never used Arduino before then ask for an instructor’s help with this part.</p>
</section>
<section id="back-to-ros">
<h2>Back to ROS<a class="headerlink" href="#back-to-ros" title="Permalink to this headline">¶</a></h2>
<p>In this lab we are using rosserial package to relay data from Arduino Nano to our ROS-based computer over a serial (USB) interface.</p>
<p>Install <code class="docutils literal notranslate"><span class="pre">rosserial</span></code> using apt.</p>
<blockquote>
<div><p><code class="code docutils literal notranslate"><span class="pre">$</span> <span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">install</span> <span class="pre">ros-noetic-rosserial-arduino</span> <span class="pre">ros-noetic-rosserial</span></code></p>
</div></blockquote>
<p>Then build the necessary libraries for Arduino.</p>
<blockquote>
<div><p><code class="code docutils literal notranslate"><span class="pre">$</span> <span class="pre">cd</span> <span class="pre">~/Arduino/libraries/</span></code></p>
<p><code class="code docutils literal notranslate"><span class="pre">$</span> <span class="pre">rosrun</span> <span class="pre">rosserial_arduino</span> <span class="pre">make_libraries.py</span> <span class="pre">./</span></code></p>
</div></blockquote>
<p>Now open the Arduino IDE again and open up <code class="docutils literal notranslate"><span class="pre">File</span> <span class="pre">&gt;</span> <span class="pre">Examples</span> <span class="pre">&gt;</span> <span class="pre">ros_lib</span> <span class="pre">&gt;</span> <span class="pre">HelloWorld</span></code> from the menus.</p>
<p>Upload this piece of code to the Arduino as is.</p>
<p>Then open up a terminal window and run <code class="docutils literal notranslate"><span class="pre">serial_node.py</span></code> from <code class="docutils literal notranslate"><span class="pre">rosserial</span></code>.</p>
<blockquote>
<div><p><code class="code docutils literal notranslate"><span class="pre">$</span> <span class="pre">rosrun</span> <span class="pre">rosserial_python</span> <span class="pre">serial_node.py</span> <span class="pre">/dev/ttyUSB0</span></code></p>
</div></blockquote>
<p>If your Arduino is connected to some other port than <code class="docutils literal notranslate"><span class="pre">/dev/ttyUSB0</span></code> then modify the command accordingly.</p>
<p>These commands started a ROS node. Use the regular ROS commands to find out which node it started, what does it publish and observe the published data.</p>
<p>Read the Arduino code that produced this result and try to understand as much of it as you can. Ask the instructors about parts that you do not understand.</p>
</section>
<section id="integrating-two-pieces-of-code">
<h2>Integrating two pieces of code<a class="headerlink" href="#integrating-two-pieces-of-code" title="Permalink to this headline">¶</a></h2>
<p>Now it is time to put the previous two Arduino codes together.</p>
<p>Integrate the ultrasonic sensing code and the <code class="docutils literal notranslate"><span class="pre">HelloWorld</span></code> example into one file.</p>
<p>Then modify the code such that the data published by the node would be data obtained from the ultrasonic sensor instead.</p>
</section>
<section id="optional-visualize-data">
<h2>Optional: visualize data<a class="headerlink" href="#optional-visualize-data" title="Permalink to this headline">¶</a></h2>
<p>Visualize the ultrasonic data in Rviz.</p>
</section>
<section id="optional-move-robot">
<h2>Optional: move robot<a class="headerlink" href="#optional-move-robot" title="Permalink to this headline">¶</a></h2>
<p>Make a robot move back and forth according to how you hold something (your hand, a piece of cardboard, or something) in front of the robot.
You can either make the robot just move forward when the hand is closer and backward when it is further away from the sensor, or you can try to mimic the hand’s position using the robot (the distance from the hand to sensor is proportional to the distance from robot to wall).</p>
</section>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="findrobot.html" class="btn btn-neutral float-right" title="Find the Robot" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Day 5" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2021, University of Tartu, License CC BY-ND-NC

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>